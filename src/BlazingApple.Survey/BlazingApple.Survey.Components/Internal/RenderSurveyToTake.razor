@using BlazingApple.Survey.Components.Services

@strError
@if (SeeResults)
{
	<button @onclick="OnStartOverClick" class="ms-1 btn btn-primary">Back</button>
	<RenderSurveyResults SelectedSurvey="SelectedSurvey"></RenderSurveyResults>
}
else if(SelectedSurvey is not null)
{
	@if (ShowSurveyComplete)
	{
		<h4>@string.Concat(SelectedSurvey.Name, " - ", @SurveyCompleteText)</h4>
	}
	else
	{
		<h4>@SelectedSurvey.Name</h4>
	}
	@if (SelectedSurvey.Questions?.Count <= 0)
	{
		<h4>@NoQuestionsText</h4>
	}
	else if(SelectedSurvey != null && SelectedSurvey.Questions != null)
	{
		<EditForm Model="@SelectedSurvey" OnValidSubmit="@SaveSurvey">
			<div>
				@foreach (DTOQuestion Question in SelectedSurvey.Questions.OrderBy(x => x.Position))
				{
					@if(Question is not null) {
						<div class="row">
							<div class="col-md-9" style="text-align: left;margin-bottom: 20px">
								<div class="form-group">
									<label for="@Question.Id.ToString()">@Question.Prompt</label>
									@if (Question.Type == QuestionType.TextBox)
									{
										<InputText id="@Question.Id.ToString()" class="form-control"
												   @bind-Value="@Question.AnswerValueString" disabled="@ShowSurveyComplete" />
									}
									@if (Question.Type == QuestionType.TextArea)
									{
										<InputTextArea id="@Question.Id.ToString()" class="form-control"
													   @bind-Value="@Question.AnswerValueString" disabled="@ShowSurveyComplete" />
									}
									@if (Question.Type == QuestionType.Date)
									{
										<InputDate id="@Question.Id.ToString()" class="form-control"
														  @bind-Value="@Question.AnswerValueDateTime"
														  TValue="DateTime?" disabled="@ShowSurveyComplete" />
									}
									@if (Question.Type == QuestionType.DateTime)
									{
										<BlazingApple.Survey.Internal.InputDateTime TValue="DateTime?" id="@Question.Id.ToString()" class="form-control"
														  @bind-Value="@Question.AnswerValueDateTime" disabled="@ShowSurveyComplete" />
									}
									@if (Question.Type == QuestionType.Dropdown)
									{
										<InputSelect id="@Question.Id.ToString()" @bind-Value="@Question.AnswerValueString"
													 class="form-control"
													 disabled="@ShowSurveyComplete" >
											@foreach(DTOQuestionOption option in @Question.Options!.OrderBy(x => x.Id)) {
												<option value="@option.OptionLabel">@option.OptionLabel</option>
											}
										</InputSelect>
									}
									@if (Question.Type == QuestionType.DropdownMultiSelect)
									{
										<RadzenDropDown Name="@Question.Id.ToString()"
														TValue="IEnumerable<string>"
														Multiple="true"
														AllowClear="true"
														AllowFiltering="true"
														@bind-Value="Question.AnswerValueList"
														Placeholder="Select..."
														Data="@Question.Options"
														TextProperty="OptionLabel"
														ValueProperty="OptionLabel"
														Style="max-width:300px;" Disabled="ShowSurveyComplete" />
									}
									@if (Question.Required)
									{
										@*<br /><RadzenRequiredValidator Component="@Question.Id.ToString()"
															  Text="Required" Popup="false"
															  Style="position: absolute" />*@
									}
								</div>
							</div>
						</div>
					}
				}
			</div>
			<div class="row">
				<div class="col-lg-12">
					<button class="btn btn-primary" type="submit" disabled="@ShowSurveyComplete">Submit</button>
					@if (ShowSurveyComplete && AllowSeeResults)
					{
						<button class="btn btn-outline-primary" @onclick="OnSeeResultsClick" style="margin-left:.5rem;">See Results</button>
					}
				</div>
			</div>
		</EditForm>
	}
}
